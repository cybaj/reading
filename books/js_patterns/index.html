<!DOCTYPE html>
<html lang="ko-KR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Javascript Patterns | cybaj IT {책, 레퍼런스} 읽기</title>
    <meta name="description" content="Stoyan Stefaonv 책 읽기">
    
    <meta name="keywords"><meta content="js javascript patterns">
    <link rel="preload" href="/reading/assets/css/0.styles.bac045ff.css" as="style"><link rel="preload" href="/reading/assets/js/app.13f47444.js" as="script"><link rel="preload" href="/reading/assets/js/10.5ab2a31e.js" as="script"><link rel="prefetch" href="/reading/assets/js/11.be418acb.js"><link rel="prefetch" href="/reading/assets/js/12.d17fcb21.js"><link rel="prefetch" href="/reading/assets/js/13.187e694e.js"><link rel="prefetch" href="/reading/assets/js/14.db544a44.js"><link rel="prefetch" href="/reading/assets/js/15.9ba6fc9c.js"><link rel="prefetch" href="/reading/assets/js/2.173a0891.js"><link rel="prefetch" href="/reading/assets/js/3.e9d2f212.js"><link rel="prefetch" href="/reading/assets/js/4.c36c8512.js"><link rel="prefetch" href="/reading/assets/js/5.286e2eca.js"><link rel="prefetch" href="/reading/assets/js/6.067ea795.js"><link rel="prefetch" href="/reading/assets/js/7.509184de.js"><link rel="prefetch" href="/reading/assets/js/8.0ceb256d.js"><link rel="prefetch" href="/reading/assets/js/9.a021e2e6.js">
    <link rel="stylesheet" href="/reading/assets/css/0.styles.bac045ff.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/reading/" class="home-link router-link-active"><!----> <span class="site-name">cybaj IT {책, 레퍼런스} 읽기</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/reading/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">About</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/reading/about/notions/" class="nav-link">notions</a></li><li class="dropdown-item"><!----> <a href="/reading/about/recipes/" class="nav-link">recipes</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">read Reference</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/reading/references/networkx/" class="nav-link">networkx</a></li><li class="dropdown-item"><!----> <a href="/reading/references/d3_js/" class="nav-link">d3.js</a></li><li class="dropdown-item"><!----> <a href="/reading/references/maven/" class="nav-link">maven</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">read Book</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/reading/books/c_datastructure/" class="nav-link">clang DS</a></li><li class="dropdown-item"><!----> <a href="/reading/books/js_patterns/" class="nav-link router-link-exact-active router-link-active">js Patterns</a></li><li class="dropdown-item"><!----> <a href="/reading/books/combinatorics/" class="nav-link">combinatorics</a></li><li class="dropdown-item"><!----> <a href="/reading/books/nag/" class="nav-link">linux network</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/reading/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">About</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/reading/about/notions/" class="nav-link">notions</a></li><li class="dropdown-item"><!----> <a href="/reading/about/recipes/" class="nav-link">recipes</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">read Reference</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/reading/references/networkx/" class="nav-link">networkx</a></li><li class="dropdown-item"><!----> <a href="/reading/references/d3_js/" class="nav-link">d3.js</a></li><li class="dropdown-item"><!----> <a href="/reading/references/maven/" class="nav-link">maven</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">read Book</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/reading/books/c_datastructure/" class="nav-link">clang DS</a></li><li class="dropdown-item"><!----> <a href="/reading/books/js_patterns/" class="nav-link router-link-exact-active router-link-active">js Patterns</a></li><li class="dropdown-item"><!----> <a href="/reading/books/combinatorics/" class="nav-link">combinatorics</a></li><li class="dropdown-item"><!----> <a href="/reading/books/nag/" class="nav-link">linux network</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Javascript Patterns</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/reading/books/js_patterns/#객체-생성-패턴" class="sidebar-link">객체 생성 패턴</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/reading/books/js_patterns/#네임스페이스-패턴" class="sidebar-link">네임스페이스 패턴</a></li><li class="sidebar-sub-header"><a href="/reading/books/js_patterns/#비공개-프로퍼티와-메서드" class="sidebar-link">비공개 프로퍼티와 메서드</a></li><li class="sidebar-sub-header"><a href="/reading/books/js_patterns/#모듈-패턴" class="sidebar-link">모듈 패턴</a></li><li class="sidebar-sub-header"><a href="/reading/books/js_patterns/#샌드박스-패턴" class="sidebar-link">샌드박스 패턴</a></li><li class="sidebar-sub-header"><a href="/reading/books/js_patterns/#스태틱-멤버" class="sidebar-link">스태틱 멤버</a></li><li class="sidebar-sub-header"><a href="/reading/books/js_patterns/#객체-상수" class="sidebar-link">객체 상수</a></li><li class="sidebar-sub-header"><a href="/reading/books/js_patterns/#체이닝-패턴" class="sidebar-link">체이닝 패턴</a></li><li class="sidebar-sub-header"><a href="/reading/books/js_patterns/#method-메서드" class="sidebar-link">method() 메서드</a></li><li class="sidebar-sub-header"><a href="/reading/books/js_patterns/#나름의-실전-문제" class="sidebar-link">나름의 실전 문제</a></li></ul></li><li><a href="/reading/books/js_patterns/#코드-재사용-패턴" class="sidebar-link">코드 재사용 패턴</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/reading/books/js_patterns/#클래스-방식-vs-새로운-방식의-상속-패턴" class="sidebar-link">클래스 방식 vs. 새로운 방식의 상속 패턴</a></li><li class="sidebar-sub-header"><a href="/reading/books/js_patterns/#클래스-방식의-상속을-사용할-경우-예상되는-산출물" class="sidebar-link">클래스 방식의 상속을 사용할 경우 예상되는 산출물</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="javascript-patterns-읽기"><a href="#javascript-patterns-읽기" aria-hidden="true" class="header-anchor">#</a> 'Javascript Patterns' 읽기</h1> <p>자바스크립트로 패키지를 어떻게 짤 수 있는지 궁금했다. 찾아보았지만, 나온 것을 본 것이 제대로 공부가 된 거 같지 않았다. 숫자에 대한 패키지를 만들어보고 싶은데, 어떻게 짤 수 있는지 멍하였다. 전에 사두고 보지 못한 책 중에 하나로 이 책이 우연히 보여 보았는데, 너무 좋았다. 5장 객체 생성 패턴에 대한 내용을 정리하고 싶었다.</p> <p>5장을 정리하는 것이 우선 목표이고, 그 후 6장 코드 재사용 패턴, 7장 디자인 패턴에 대해 정리한 후,
나머지 부분을 목차대로 정리하고 싶다.</p> <h2 id="객체-생성-패턴"><a href="#객체-생성-패턴" aria-hidden="true" class="header-anchor">#</a> 객체 생성 패턴</h2> <p>자바스크립트에는 네임스페이스 모듈 패키지, 비공개 프로퍼티를 위한 별도의 문법 (예를 들어 그런 키워드) 가 없다. 따라서 이를 대체할 수 있는 방법이 필요하다. ( ES6 에는 클래스가 있지만.. )</p> <blockquote><p>이러한 기능들을 구현하거나 대체하거나 또는 다른 관점에서 바라볼 수 있게 해주는 범용적인 패턴들에 대해 알아본다. (103p)</p></blockquote> <p>책에서는 '네임스페이스 패턴', '의존 관계 선언', '모듈 패턴', '샌드박스 패턴' 을 배운다. 이를 통해</p> <blockquote><p>애플리케이션 코드를 정리하고 구조화할 수 있게 도와주고 암묵적 전역의 영향력을 약화시킨다.
&quot;이 밖에도 비공개 멤버와 특권 멤버, 공개/비공개 스태틱 멤버, 객체 상수, 체이닝, 클래스와 비슷한 방식으로 생성자를 정의하는 방법&quot;도 배운다.</p></blockquote> <h3 id="네임스페이스-패턴"><a href="#네임스페이스-패턴" aria-hidden="true" class="header-anchor">#</a> 네임스페이스 패턴</h3> <ul><li>전역 변수의 개수를 줄여준다.</li> <li>과도한 접두어를 사용하지 않고 이름이 겹치지 않게 해준다.</li></ul> <blockquote><p>애플리케이션이나 라이브러리르 위한 전역 객체를 하나 만들고 (단 하나만 만드는 것이 이상적이다.) 모든 기능을 이 객체에 추가하면 된다.</p></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 생성자 함수 2개</span>
<span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 변수 1개</span>
<span class="token keyword">var</span> some_var <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">// 객체 2개</span>
<span class="token keyword">var</span> module1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
module1<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> c<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> module2 <span class="token operator">=</span> <span class="token punctuation">{</span>ddddd<span class="token punctuation">:</span> <span class="token string">&quot;ah, SSSCO&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>수정전 코드는 전역변수가 5개 ( 생성자 2, 변수 1, 객체 2 }</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 전역 객체</span>
<span class="token keyword">var</span> <span class="token constant">MYAPP</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 생성자</span>
<span class="token constant">MYAPP</span><span class="token punctuation">.</span><span class="token function-variable function">Parent</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token constant">MYAPP</span><span class="token punctuation">.</span><span class="token function-variable function">Child</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 변수</span>
<span class="token constant">MYAPP</span><span class="token punctuation">.</span>some_var <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">// 객체 컨테이너</span>
<span class="token constant">MYAPP</span><span class="token punctuation">.</span>modules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 객체들을 컨테이너에 추가</span>
<span class="token constant">MYAPP</span><span class="token punctuation">.</span>modules<span class="token punctuation">.</span>module1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token constant">MYAPP</span><span class="token punctuation">.</span>modules<span class="token punctuation">.</span>module1<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token string">'데이터들'</span>
<span class="token constant">MYAPP</span><span class="token punctuation">.</span>modules<span class="token punctuation">.</span>module2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>전역 네임스페이스를 사용하면 전역객체가 1개로.</p> <p>단점</p> <ul><li>모든 변수와 함수에 접두어 =&gt; 코드량 증가, 스크립트 파일 크기 증가</li> <li>전역 인스턴스가 하나이므로, 어느 한 부분을 수정하더라도 전역 인스턴스를 수정해야함</li> <li>이름이 중첩되고 길어지므로, 프로퍼티를 판별하기 위한 검색 작업도 길고 느려짐. (예를 들어 MYAPP.modules.module11.data.abc.cards[222].dosomething ..)</li> <li>그리고 이미 존재하는 경우, 그것을 덮어쓰는 위험성</li></ul> <h4 id="범용-네임스페이스-함수"><a href="#범용-네임스페이스-함수" aria-hidden="true" class="header-anchor">#</a> 범용 네임스페이스 함수</h4> <p>마지막에, 이미 존재하는 것을 덮어쓰는 위험성을 없애기 위한 스니펫</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 위험한 경우</span>
<span class="token keyword">var</span> <span class="token constant">MYAPP</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 개선안</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token constant">MYAPP</span> <span class="token operator">===</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> <span class="token constant">MYAPP</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 더 짧게</span>
<span class="token keyword">var</span> <span class="token constant">MYAPP</span> <span class="token operator">=</span> <span class="token constant">MYAPP</span> <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 있으면 그대로 없으면 생성</span>

<span class="token comment">// p.105</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>그런데 모든 멤버에 대해 이런 중복을 따지면, 이를 위한 함수가 있는 것이 좋겠다.
책에서는 <code>범용 네임스페이스 함수</code> 라고 말하는 함수</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token constant">MYAPP</span> <span class="token operator">=</span> <span class="token constant">MYAPP</span> <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token constant">MYAPP</span><span class="token punctuation">.</span><span class="token function-variable function">namespace</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ns_string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 추가할 모듈 멤버를 단계별로 있는지 확인하고 없으면 만들고 있으면 그것 아래 두는 식으로..</span>
    <span class="token comment">// parts 는 확인할 단계별 녀석들</span>
    <span class="token keyword">var</span> parts <span class="token operator">=</span> ns_string<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        parent <span class="token operator">=</span> <span class="token constant">MYAPP</span><span class="token punctuation">,</span>
        i<span class="token punctuation">;</span>

    <span class="token comment">// 처리할 parts 중에서 처리할 필요 없는 전역객체 부분은 넘겨버린다.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>parts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&quot;MYAPP&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        parts <span class="token operator">=</span> parts<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 시작</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> parts<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 프로퍼티가 존재 않으면 생성한다.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> parent<span class="token punctuation">[</span>parts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            parent<span class="token punctuation">[</span>parts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        parent <span class="token operator">=</span> parent<span class="token punctuation">[</span>parts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> parent<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// p.106</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p><code>범용 네임스페이스 함수</code>의 사용</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> module2 <span class="token operator">=</span> <span class="token constant">MYAPP</span><span class="token punctuation">.</span><span class="token function">namespace</span><span class="token punctuation">(</span><span class="token string">'MYAPP.modules.module2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 또는 MYAPP.namespace('modules.module2');</span>
module2 <span class="token operator">===</span> <span class="token constant">MYAPP</span><span class="token punctuation">.</span>modules<span class="token punctuation">.</span>module2<span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>옮긴이의 각주: namespace는 JS의 예약어로 포함되어 있으므로, ... 이를 피하자.</p> <h4 id="의존성-관계-선언"><a href="#의존성-관계-선언" aria-hidden="true" class="header-anchor">#</a> 의존성 관계 선언</h4> <p>자, 이제 네임스페이스로 묶었고, 필요한 모듈부분만 골라서 쓸 수 있다. YUI2에는 YAHOO라는 전역변수가 있고, YAHOO.util.DOM 같이 골라서 쓸 수 있다. 그렇게 만들 수 있다.<br>
단, 이 때 한가지를 더 염두하자.<br>
갖다 쓸 그 필요한 모듈 부분들을 모듈 내 최상단에 선언하자.  (책에서는 의존관계에 있는 모듈을 선언하는 것이라고.)</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> my <span class="token function-variable function">Function</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 의존 관계에 있는 모듈들</span>
    <span class="token keyword">var</span> event <span class="token operator">=</span> <span class="token constant">YAHOO</span><span class="token punctuation">.</span>util<span class="token punctuation">.</span>Event<span class="token punctuation">,</span>
        dom <span class="token operator">=</span> <span class="token constant">YAHOO</span><span class="token punctuation">.</span>util<span class="token punctuation">.</span>Dom<span class="token punctuation">;</span>

    <span class="token comment">// 이제 event, dom 지역변수를 사용한다.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// p.107</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>장점 (p.107)</p> <ul><li>의존 관계 명시적으로 나타남. 쓰는 사람이 필요한 스크립트 파일 확인 쉬움.</li> <li>의존 관계 이해하기 편함.</li> <li>dom 같은 지역변수가 YAHOO와 같은 전역 변수보다 언제나 더 빠르며, 특히 YAHOO.util.Dom 처럼 중첩된 경우는 그렇다.</li> <li>스크립트 압축 시 지역변수에 대해 축약해주지만, 전역 변수는 위험해 축약하지 않는다.</li></ul> <p>스크립트 압축에 대한 예가 책에 있다.</p> <h3 id="비공개-프로퍼티와-메서드"><a href="#비공개-프로퍼티와-메서드" aria-hidden="true" class="header-anchor">#</a> 비공개 프로퍼티와 메서드</h3> <blockquote><p>자바 등 다른 언어와는 달리 자바스크립트에는 private, protected, public 프로퍼티와 메서드를 나타내는 별도의 문법이 없다. (p.109)</p></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Gadget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'iPod'</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> toy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gadget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>toy<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// name 이 공개되어 있다.</span>

<span class="token comment">// 그런데 아래는 비공개 되어 있다.</span>
<span class="token keyword">function</span> <span class="token function">Gadget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'iPod'</span>
<span class="token punctuation">}</span>

<span class="token comment">// 이를 getter 를 따로 구현해 얻는다.</span>
<span class="token keyword">function</span> <span class="token function">Gadget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'iPod'</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> toy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gadget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>toy<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 이건 안되고</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>toy<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 이건 되고</span>

<span class="token comment">// p.110</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h4 id="특권-privileged-메서드"><a href="#특권-privileged-메서드" aria-hidden="true" class="header-anchor">#</a> 특권(privileged) 메서드</h4> <blockquote><p>getName()은 비공개 프로퍼티인 name에 '특별한' 접근권한을 가지고 있기 때문에 특권 메서드라고 할 수 있다. (p.110)</p></blockquote> <h4 id="비공개-멤버의-허점"><a href="#비공개-멤버의-허점" aria-hidden="true" class="header-anchor">#</a> 비공개 멤버의 허점</h4> <ul><li>옛날 브라우저 eval 두번째 매개변수로 비공개 유효범위를 볼 수 있는 컨텍스트 객체가 있고...</li> <li>이것이 중요해 보이는데, 특권 메서드에서 비공개 프로퍼티를 &quot;바로 반환&quot;하는 경우에, &quot;값이 아닌 참조&quot;가 반환되기 때문에, 외부에서 비공개 변수 값을 수정할 수 있게 된다.</li></ul> <p>따라서 특권 메서드 안에서 밖으로 보낼 비공개 변수는 필요한 최소한의 것만, (Principle of Least Authority, POLA, 최소 권한의 원칙) 보내고,<br>
만약 모든 것을 보내야 한다면, 객체를 복사해서 보는 낸 것. (이때, 얕은 복사를 '최상위 프로퍼티 복사'로, 깊은 복사를 '모든 중첩 프로퍼티를 재귀적으로 복사'하는 것으로 책에서 보고 있다.)</p> <h4 id="객체-리터럴과-비공개-멤버"><a href="#객체-리터럴과-비공개-멤버" aria-hidden="true" class="header-anchor">#</a> 객체 리터럴과 비공개 멤버</h4> <p>생성자가 아니라, 객체 리터럴로 생성했을 때, 비공개 멤버를 구현해보자.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myobj<span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">&quot;my, oh my&quot;</span>

    myobj <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">getName</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> name<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myobj<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// p.112</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><blockquote><p>비공개 데이터를 함수로 감싸기만 하면된다. 따라서 객체 리터럴에서는 익명 즉시 실행 함수를 추가하여 클로저를 만든다.</p></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 고쳐서</span>
<span class="token keyword">var</span> myobj <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 비공개 멤버</span>
    <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">&quot;my, oh my&quot;</span>

    <span class="token comment">// 공개될 부분</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">getName</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> name<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myobj<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// p.113</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><blockquote><p>이 예제는 곧 살펴보게 될 '모듈 패턴'의 기초가 되는 부분이기도 하다.</p></blockquote> <h4 id="프로토타입과-비공개-멤버"><a href="#프로토타입과-비공개-멤버" aria-hidden="true" class="header-anchor">#</a> 프로토타입과 비공개 멤버</h4> <p>이제 생성자를 쓸 때, 비공개 멤버를 구현할 수 있고, 객체 리터럴 쓸 때, 비공개 멤버를 구현할 수 있다.
근데, 생성자로 비공개 멤버 구현할 때, this를 써서 했었는데,</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Crow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> privated <span class="token operator">=</span> <span class="token string">&quot;a12&quot;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">getData</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> privated<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>새로운 객체를 만들 때마다 비공개 멤버 재성성되는 것에 대해, prototype을 써보자.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Gadget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'iPod'</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token class-name">Gadget</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> browser <span class="token operator">=</span> <span class="token string">&quot;Mobile Webkit&quot;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">getBrowser</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> browser
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// p.114</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="비공개-함수를-공개-메서드로-노출시키는-방법"><a href="#비공개-함수를-공개-메서드로-노출시키는-방법" aria-hidden="true" class="header-anchor">#</a> 비공개 함수를 공개 메서드로 노출시키는 방법</h4> <blockquote><p>객체의 모든 기능이 객체가 수행하는 작업에 필수불가결한 것들이라서 최대한의 보호가 필요한데, 동시에 이 기능들의 유용성 때문에 공개적인 접근도 허용하고 싶은 경우가 있을 수 있다. ... 매서드가 공개되어 있다는 것은 결국 이 메서드가 위험에 노출되어 있다는 말과도 같다. (p.114)</p></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ......</span>

    myarray <span class="token operator">=</span> <span class="token punctuation">{</span>
        isArray<span class="token punctuation">:</span> isArray<span class="token punctuation">,</span>
        indexOf<span class="token punctuation">:</span> indexOf<span class="token punctuation">,</span>
        inArray<span class="token punctuation">:</span> indexOf
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myarray<span class="token punctuation">.</span>indexOf <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
myarray<span class="token punctuation">.</span><span class="token function">inArray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="모듈-패턴"><a href="#모듈-패턴" aria-hidden="true" class="header-anchor">#</a> 모듈 패턴</h3> <p>여기까지, 네임스페이스로 묶고, 묶은 거 쓸 때 의존성 선언해서 로컬로 쓰고, 모듈 만들 때 변수든 메서드든 감출 것은 감출 수 있다. 그리고 특히 IIFE를 이용해서 객체 리터럴로 비공개되는 부분을 갖는 객체를 쓰는 것을 배웠다.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 다시 기억해보기</span>
<span class="token keyword">var</span> myobj <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    varname <span class="token operator">=</span> <span class="token string">&quot;my, oh my&quot;</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">getName</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> name<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myobj<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// p.113</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>모듈 패턴은 이것들을 조합한 것이라고 한다.</p> <ol><li>먼저 네임스페이스를 설정한다.</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">MYAPP</span><span class="token punctuation">.</span><span class="token function">namespace</span><span class="token punctuation">(</span><span class="token string">'MYAPP.utilities.array'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>IIFE 로 비공개 범위와 공개 인터페이스가 담긴 모듈을 정의할 것이다.
여기에 추가해야 하는데</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">MYAPP</span><span class="token punctuation">.</span>utilities<span class="token punctuation">.</span>array <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token comment">/* 
        여기에 추가하는데
        */</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="3"><li>공개API 메서드를 추가하면 이렇다.</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">MYAPP</span><span class="token punctuation">.</span>utilities<span class="token punctuation">.</span>array <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">inArray</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">needle<span class="token punctuation">,</span> haystack</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">isArray</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="4"><li>모듈 안에서 사용할 의존 관계를 정의한다.</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">MYAPP</span><span class="token punctuation">.</span>utilities<span class="token punctuation">.</span>array <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 최상단에 의존관계를 정의한다.</span>
    <span class="token keyword">var</span> uboj <span class="token operator">=</span> <span class="token constant">MYAPP</span><span class="token punctuation">.</span>utilities<span class="token punctuation">.</span>object<span class="token punctuation">,</span>
        ulang <span class="token operator">=</span> <span class="token constant">MYAPP</span><span class="token punctuation">.</span>utilites<span class="token punctuation">.</span>lang

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">inArray</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">needle<span class="token punctuation">,</span> haystack</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">isArray</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="5"><li>비공개 프로퍼티, 비공개 메서드들 추가할 수 있다.</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">MYAPP</span><span class="token punctuation">.</span>utilities<span class="token punctuation">.</span>array <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> uboj <span class="token operator">=</span> <span class="token constant">MYAPP</span><span class="token punctuation">.</span>utilities<span class="token punctuation">.</span>object<span class="token punctuation">,</span>
        ulang <span class="token operator">=</span> <span class="token constant">MYAPP</span><span class="token punctuation">.</span>utilites<span class="token punctuation">.</span>lang

    <span class="token comment">// 비공개 프로퍼티</span>
    <span class="token keyword">var</span> array_string <span class="token operator">=</span> <span class="token string">&quot;[object Array]&quot;</span><span class="token punctuation">,</span>
        ops <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString

    <span class="token comment">// 비공개 메서드</span>
    <span class="token keyword">var</span> <span class="token function-variable function">some_methods</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ... }</span>

    <span class="token comment">/* 여기까지 var 선언을 마친다. */</span>

    <span class="token comment">// 필요한 경우 일회성 초기화 절차를 실행한다.</span>
    <span class="token comment">// ...</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">inArray</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">needle<span class="token punctuation">,</span> haystack</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">isArray</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// ... 더 필요한 메서드와 프로퍼티를 여기에 추가한다.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// p.117</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><blockquote><p>모듈 패턴은 특히 점점 늘어만 가는 코드를 정리할 때 널리 사용되며 매우 추천하는 방법이다.</p></blockquote> <h4 id="모듈-노출-패턴"><a href="#모듈-노출-패턴" aria-hidden="true" class="header-anchor">#</a> 모듈 노출 패턴</h4> <p>위 코드에서, 모든 매서드를 감추고, 골라서 공개하고, 그래서 밖으로부터 좀 안전성을 키워보자.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">MYAPP</span><span class="token punctuation">.</span>utilities<span class="token punctuation">.</span>array <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> array_string <span class="token operator">=</span> <span class="token string">&quot;[object Array]&quot;</span><span class="token punctuation">,</span>
        ops <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toSTring

    <span class="token comment">// 비공개 메서드</span>
    <span class="token keyword">var</span> <span class="token function-variable function">inArray</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ... },</span>
        <span class="token function-variable function">isArray</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ... }</span>

    <span class="token comment">// 공개 API 노출</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        isArray<span class="token punctuation">:</span> isArray<span class="token punctuation">,</span>
        indexOf<span class="token punctuation">:</span> inArray
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// p.118</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="생성자를-생성하는-모듈"><a href="#생성자를-생성하는-모듈" aria-hidden="true" class="header-anchor">#</a> 생성자를 생성하는 모듈</h4> <p>앞선 것은 MYAPP.utilities.array 라는 객체를 만들어 사용할 수 있었고.<br>
그렇게 모듈 객체들을 이것저것 만들어서 사용할 수 있겠다.<br>
이 경우는 모두 IIFE로 모듈을 감싸 반환하는 것이다.</p> <p>이러지 않고, 생성자 함수를 반환하여, 이를 사용하는 패턴도 생각해볼 수 있다.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">MYAPP</span><span class="token punctuation">.</span><span class="token function">namespace</span><span class="token punctuation">(</span><span class="token string">'MYAPP.utilities.Array'</span><span class="token punctuation">)</span>

<span class="token constant">MYAPP</span><span class="token punctuation">.</span>utilities<span class="token punctuation">.</span>Array <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 의존성 선언</span>
    <span class="token keyword">var</span> uobj <span class="token operator">=</span> <span class="token constant">MYAPP</span><span class="token punctuation">.</span>utilities<span class="token punctuation">.</span>object<span class="token punctuation">,</span>
        ulang <span class="token operator">=</span> <span class="token constant">MYAPP</span><span class="token punctuation">.</span>utilities<span class="token punctuation">.</span>lang

    <span class="token comment">// 비공개 프로퍼티와 매서드들을 선언</span>
    <span class="token keyword">var</span> Constr<span class="token punctuation">;</span>

    <span class="token comment">// var 선언을 마치고.</span>

    <span class="token comment">// 필요한 일회성 초기화</span>
    <span class="token comment">// ...</span>
    
    <span class="token comment">// 공개 API - 생성자 함수</span>
    <span class="token function-variable function">Constr</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>elements <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 공개 API - 프로토타입</span>
    <span class="token class-name">Constr</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
        constructor<span class="token punctuation">:</span> <span class="token constant">MYAPP</span><span class="token punctuation">.</span>utilities<span class="token punctuation">.</span>Array<span class="token punctuation">,</span>
        version<span class="token punctuation">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">toArray</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 이 생성자 함수를 반환한다.</span>
    <span class="token comment">// 이 함수가 새로운 네임스페이스에 할당될 것이다.</span>
    <span class="token keyword">return</span> Constr<span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MYAPP<span class="token punctuation">.</span>utilities<span class="token punctuation">.</span>Array</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

arr<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span>

<span class="token comment">// p.119</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>이렇게 생성자와 프로토타입 부분에 뭔가를 더 할 수 있겠다.<br>
의존성 부분, 비공개 부분, 공개 API 부분, 그리고 그것들을 활용한 생성자 부분, 그 생성자의 프로토타입 부분</p> <h4 id="모듈에-전역-변수-가져오기"><a href="#모듈에-전역-변수-가져오기" aria-hidden="true" class="header-anchor">#</a> 모듈에 전역 변수 가져오기</h4> <p>그리고 결국 이거.<br>
IIFE 에 인자를 전달하는 것을 생각해볼 수 있겠다.<br>
특히 글로벌 객체, 전역 어플리케이션 네임스페이스 객체를 전달해줄 수 있다면,<br>
&quot;그것들을 지역변수로 사용할 수 있기 때문에, 탐색 작업이 좀 더 빨라진다.&quot;</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">MYAPP</span><span class="token punctuation">.</span>utilities<span class="token punctuation">.</span>module <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">app<span class="token punctuation">,</span> global</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 전역 객체에 대한 참조와</span>
    <span class="token comment">// 전역 애플리케이션 네임스페이스 객체에 대한 참조가 지역 변수화 된다.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token constant">MYAPP</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 이렇게 글로벌 컨텍스트 상에서 var MYAPP = MYAPP || {} , 글로벌 this 가 모듈에 전달되는 것을 안다.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="샌드박스-패턴"><a href="#샌드박스-패턴" aria-hidden="true" class="header-anchor">#</a> 샌드박스 패턴</h3> <p>모듈 패턴은 너무 좋아보인다.<br>
그런데 샌드박스 패턴이라니, 뭐지.<br>
샌드박스 패턴은 왜 나올까?</p> <p>하나의 네임스페이스를 갖는 패턴은 다음과 같은 단점을 갖는다.</p> <ul><li>단 하나의 전역변수에 의존한다. 따라서 동일한 애플리케이션, 라이브러리의 두가지 버전을 한 페이지에서 실행시키는 것이 불가능</li> <li>MYAPP.utilities.array 와 같이 점으로 연결된 긴 이름을 써야 함. 런타임에 그만큼의 탐색 작업이 필요함.</li></ul> <p>그렇다면 샌드박스 패턴이란 게 뭘까 일단</p> <blockquote><p>어떤 모듈이 다른 모듈과 그 모듈의 샌드박스에 영향을 미치지 않고 동작할 수 있는 환경을 제공한다. (p.120)</p></blockquote> <h4 id="전역-생성자"><a href="#전역-생성자" aria-hidden="true" class="header-anchor">#</a> 전역 생성자</h4> <p>기존 <em>네임스페이스 패턴</em>에서는 글로벌은 <code>MYAPP</code> 같은 것으로써, 하나만 있게 된다.<br> <em>샌드박스 패턴</em>에서는 생성자가 유일한 글로벌이다.</p> <p>일단 <code>MYAPP</code> 같은 네임스페이스를 역할을 하는 <code>box</code>를 받아 어느 스코프 안에서 처리하는 게 하는 것이다.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Sandbox</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">box</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 여기에 코드들</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>이렇게 네임스페이스를 받는 함수로 묶으면 될 것이고,<br>
그 함수를 샌드박스 생성자에 전달한다.
(샌드박스 생성자는 유일한 글로벌이다.)</p> <p>여기에 두가지 부분을 추가하고자 한다고 한다.</p> <ul><li>new를 강제하는 패턴을 넣어, new 없이 사용할 수 있게 함.</li> <li>Sandbox를 통해 모듈로 구현된 필요한 처리들을 모아 제공하고자 할 것이고, Sandbox() 생성자가 필요한 그 모듈 이름에 대한 정보를 받을 수 있는 선택적인 인자를 만든다.</li></ul> <p>이중 앞에 것, new를 강제하는 패턴은 아래와 같다.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Waffle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 아래 조건문은 &quot;현재 실행되는 함수(callee)가 this와 같다면&quot; 그러니까, this는 그 매핑 규칙에 의해, 함수를 호출한 것이 될 수 있고, new에 의해 되었다면 스스로일 수 있기 때문에, 결국 &quot;new 에 의해 함수가 실행됐다면&quot;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">arguments<span class="token punctuation">.</span>callee</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">arguments<span class="token punctuation">.</span>callee</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// p.58</span>
<span class="token comment">// 이 코드의 callee는 ES 5의 Strict Mode에서는 동작 안함. 따라서 이것을 위의 경우 'Waffle'로 명시해주어 이용한다.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>그렇다. 우린 갖고 있는 모듈들로 기능을 제공하고자 하고, 해당 기능 로직을 콜백함수로 샌드박스 내부 환경에 격리시킬 것이다. 필요한 모듈 이름을 전달할 것이다. 바람직한 동작을 막기 위해 new를 강제하는 패턴을 둘 것이다.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">Sandbox</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'ajax'</span><span class="token punctuation">,</span> <span class="token string">'event'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">box</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// console.log(box);</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// p.121</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>sandbox 를 통한 구현 안에 또 다른 sandbox를 두더라도, 둘의 scope는 간섭이 없다.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">Sandbox</span><span class="token punctuation">(</span><span class="token string">'dom'</span><span class="token punctuation">,</span> <span class="token string">'event'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">box</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/*
        dom 과 event를 가지고 작업하는 코드
    */</span>
    <span class="token function">Sandbox</span><span class="token punctuation">(</span><span class="token string">'ajax'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">box</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 여기에 box 는 위 box 와 격리</span>
        <span class="token comment">/*
            ajax 를 가지고 작업하는 코드
        */</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 더이상 ajax에 관련된 내용 없음</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// p.122</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li>원하는 유형별로 모듈의 인스턴스를 여러개 만들 수 있다.</li> <li>필요하다면 함수는 곧 객체이기 때문에 Sandbox() 생성자의 '스태틱' 프로퍼티에 데이터 저장.</li> <li>콜백함수로 코드를 감싸, 전역 네임스페이스를 보호.</li></ul> <h4 id="모듈-추가하기"><a href="#모듈-추가하기" aria-hidden="true" class="header-anchor">#</a> 모듈 추가하기</h4> <p>자, 여태까지는 Sandbox를 어떻게 사용할 것이냐에 대한 내용이었다. 그러니까 모듈을 갖다가 어떻게 쓸 것이냐에 대한 내용이었다.<br>
이제 갖다 쓸 모듈들을 어떻게 갖다 쓸 수 있게 Sandbox에 달아두겠느냐.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>Sandbox<span class="token punctuation">.</span>modules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// dom 이란 모듈을 app 객체에 해당 로직을 달게 만든다.</span>
Sandbox<span class="token punctuation">.</span>modules<span class="token punctuation">.</span><span class="token function-variable function">dom</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">box</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    box<span class="token punctuation">.</span><span class="token function-variable function">getElement</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    box<span class="token punctuation">.</span><span class="token function-variable function">getStyle</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    box<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">&quot;bar&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment">// event 모듈도 app 객체에 달리게 하자.</span>
Sandbox<span class="token punctuation">.</span>modules<span class="token punctuation">.</span><span class="token function-variable function">event</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">box</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    box<span class="token punctuation">.</span><span class="token function-variable function">attachEvent</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    box<span class="token punctuation">.</span><span class="token function-variable function">detachEvent</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//필요에 따라서 Sandbox 프로토타입에 접근도 할 수 있다.</span>
    <span class="token comment">// box.constructor.prototype.m = &quot;mmm&quot;</span>
<span class="token punctuation">}</span>


<span class="token comment">// ajax 모듈도 app 객체 달자.</span>
Sandbox<span class="token punctuation">.</span>modules<span class="token punctuation">.</span><span class="token function-variable function">ajax</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">box</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    box<span class="token punctuation">.</span><span class="token function-variable function">makeRequest</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    box<span class="token punctuation">.</span><span class="token function-variable function">getResponse</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// p.123</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h4 id="생성자-구현"><a href="#생성자-구현" aria-hidden="true" class="header-anchor">#</a> 생성자 구현</h4> <p>사용할 modules을 다는 방법도 배웠고, Sandbox를 사용하는 것도 배웠으니 (<code>Sandbox('ajax', function(box) { // ... })</code>)<br>
이제 이 Sandbox 생성자를 어떻게 만들 것이냐를 배우자.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Sandbox</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// arguments =&gt; 배열</span>
    <span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// Sandbox 의 사용</span>
    <span class="token comment">// Sandbox('dom', 'event', function (box) { // ... } )</span>
    <span class="token comment">// 마지막 인자는 처리 내용이 담긴 콜백함수 이므로</span>
        callback <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        modules <span class="token operator">=</span> <span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token operator">?</span> args <span class="token punctuation">:</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        i<span class="token punctuation">;</span>

    <span class="token comment">// 함수가 생성자로 호출되도록 보장한다.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Sandbox</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Sandbox</span><span class="token punctuation">(</span>modules<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// this에 필요한 프로퍼티들을 추가한다.</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span>

    <span class="token comment">// 코어 'this' 객체에 모듈을 추가한다</span>
    <span class="token comment">// 모듈이 없거나 &quot;*&quot; 이면 사용 가능한 모든 모듈을 사용한다는 의미다.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>modules <span class="token operator">||</span> modules <span class="token operator">===</span> <span class="token string">'*'</span> <span class="token operator">||</span> modules<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'*'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        modules <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> Sandbox<span class="token punctuation">.</span>modules<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>Sandbox<span class="token punctuation">.</span>modules<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                modules<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 필요한 모듈들을 초기화한다. 그러니까 this (app 객체가 될 것)에 모듈 로직을 달자.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> modules<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Sandbox<span class="token punctuation">.</span>modules<span class="token punctuation">[</span>modules<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 콜백 함수를 호출한다. 모듈을 달고 있는, 초기화된 app 객체를 이제 그 모듈들을 활용한 처리하는 격리된 부분인 콜백함수에 전달해 호출한다.</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>결국 하려는 것은 어떤 모듈처리를 활용한 처리를 하고 싶은 것이고,<br>
필요로 하는 모듈이 달려 있는 app 객체를, 활용하는 로직이 담겨있을, 격리되어 있는 콜백 함수에 전달해 호출한다.</p> <p>이렇게 모듈로 제공된 기존의 처리를 활용한 처리를 할 수 있는<br>
공간을 제공하는데, 그것이 격리되어 있어 좋은 것.</p> <p>앞서 배운 모듈을 정의하는 방법으로써 __모듈 패턴__과 그 모듈을 활용하는 인터페이스 층을 만드는 방법으로 __샌드박스 패턴__을 이해하게 되었다.<br>
콜백함수 안에서 정의한 모듈을 맘대로 하여 쓴다.</p> <p>다시 또 생각해보면, <strong>모듈 패턴</strong> 역시 의존하고 있는 모듈을 가져와서 사용하고 있다. 그런데 모듈을 정의하는 방법으로써 __모듈 패턴__을 보게 된 것은, 아무래도 공개하고자 하는 API를 선택해 공개하는 것 때문인 거 같다.</p> <p>모듈을 사용하는 입장에서 <strong>모듈 패턴</strong> 과 <strong>샌드박스 패턴</strong> 의 큰 차이는, 결국 콜백으로 처리로직을 감싸주는 것인 것으로 생각되었다. 사용하는 모듈은 그에 각각에 맞게 정의되어 있어야 할 것 같다.</p> <h3 id="스태틱-멤버"><a href="#스태틱-멤버" aria-hidden="true" class="header-anchor">#</a> 스태틱 멤버</h3> <p>js에서 공개 스태틱 멤버, 비공개 스태틱 멤버를 구현하는 방법을 배워본다.</p> <h4 id="공개-스태틱-멤버"><a href="#공개-스태틱-멤버" aria-hidden="true" class="header-anchor">#</a> 공개 스태틱 멤버</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 생성자</span>
<span class="token keyword">var</span> <span class="token function-variable function">Gadget</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 스태틱 메서드</span>
Gadget<span class="token punctuation">.</span><span class="token function-variable function">isShiny</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;you bet&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 프로토타입에 일반적인 함수를 추가.</span>
<span class="token class-name">Gadget</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">setPrice</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">price</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> price<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// p.125</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>일반적인 함수는 prototype에.<br>
스태틱 메서드는 생성자 멤버로.</p> <p>재밌는 것은 저렇게 정의한 스태틱 메서드는 인스턴스에 호출이 안된다는 것.<br>
그래서 prototype에도 달아준다.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> iphone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gadget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">typeof</span> iphone<span class="token punctuation">.</span>isShiny<span class="token punctuation">;</span> <span class="token comment">// &quot;undefined&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token class-name">Gadget</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>isShiny <span class="token operator">=</span> Gadget<span class="token punctuation">.</span>isShiny<span class="token punctuation">;</span>
iphoen<span class="token punctuation">.</span><span class="token function">isShiny</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;you bet&quot;</span>

<span class="token comment">// p. 126</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>더 재미있는 것은, 스태틱 메서드를 &quot;스태틱하지 않은 방식&quot;으로 호출했을 때에 대해 조건을 둘 수 있다는 것.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 생성자</span>
<span class="token keyword">var</span> <span class="token function-variable function">Gadget</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">price</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> price<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 스태틱 메서드</span>
Gadget<span class="token punctuation">.</span><span class="token function-variable function">isShiny</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 다음은 항상 동작한다.</span>
    <span class="token keyword">var</span> msg <span class="token operator">=</span> <span class="token string">&quot;you bet&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// 다음은 스태틱하지 않은 방식으로, 그러니까 인스턴스에서 호출 되었을 때만 동작한다.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Gadget</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        msg <span class="token operator">+=</span> <span class="token string">&quot;, it costs $&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>price<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> msg<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 프로토타입에 추가하는데, 이번에는 call을 이용해서. 여기서의 this는 인스턴스가 될 것.</span>
<span class="token comment">// call 없이 스태틱 메서드를 호출한다면, 그냥 msg = &quot;you bet&quot;이 되겠지.</span>
<span class="token class-name">Gadget</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">isShiny</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Gadget<span class="token punctuation">.</span><span class="token function">isShiny</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// p. 127</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h4 id="비공개-스태틱-멤버"><a href="#비공개-스태틱-멤버" aria-hidden="true" class="header-anchor">#</a> 비공개 스태틱 멤버</h4> <p>비공개 스태틱 멤버란,</p> <ul><li>동일한 생성자 함수로 생성된 객체들이 공유하는 멤버다.</li> <li>생성자 외부에서는 접근할 수 없다.</li></ul> <p>prototype에 정의된 일반 함수와의 차이가 있다. 각 인스턴스가 갖는 함수가 아니라, 인스턴스들이 공유하는 함수다.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> Gadget <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 스태틱 변수/프로퍼티</span>
    <span class="token keyword">var</span> counter <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token comment">// </span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> g1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gadget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1이 출력된다.</span>
<span class="token keyword">var</span> g2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gadget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2이 출력된다.</span>
<span class="token keyword">var</span> g3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gadget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3이 출력된다.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>closure 로 모든 instance가 동일한 counter 를 공유하고 있게 된다.<br>
하나씩 늘어나고 있는데<br>
객체의 유일성을 식별하는 ID로 쓸 수 있겠다.<br>
쓸모가 많으니, 특권 메서드로 노출시키자.<br>
앞서서 생성자로 쓸 함수객체를 return 문에 바로 선언해버리면, 인스턴스의 멤버함수를 prototype 으로 줄 수 없으니,<br>
앞서 생성자로 쓸 함수객체를 선언하고, 이것의 prototype을 선언한다.  같은 함수 안에 정의 되어 있어 closure로 counter를 따오게 될 것.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> Gadget <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">var</span> counter <span class="token operator">=</span> <span class="token number">0</span>
        NewGadget<span class="token punctuation">;</span>

    <span class="token function-variable function">NewGadget</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        counter <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">NewGadget</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getLastId</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> counter
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> NewGadget

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> iphone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gadget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
iphone<span class="token punctuation">.</span><span class="token function">getLastId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> ipod <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gadget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ipod<span class="token punctuation">.</span><span class="token function">getLastId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// p.129</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>이렇게 여러 인스턴스가 공유하는 값에 대한 스태틱 함수를 사용할 수 있게 되었다.<br>
정말 편하고 중요한 것은 공유하고자 하는 값을 colsure 로 받을 수 있게 함수 안에서 선언해주고,<br>
생성자 역할을 할 함수객체를 처리를 IIFE로 묶어 처리해 얻어내는 것.<br>
이런 방법은 자주 쓰일 것이고, 편리하다.<br>
모든 함수는 객체인 것이 중요하게 언급되는데, 난 모든 그것보다, (함수가 일급객체가 아닌 언어에서 생성자가 객체를 만들어내고 있었고) js에서 객체를 만들어내는 함수를, 또다른 함수를 통해 정해서 뱉을 수 있다는 것이 자연스러워야 겠다고 생각됐다.</p> <h3 id="객체-상수"><a href="#객체-상수" aria-hidden="true" class="header-anchor">#</a> 객체 상수</h3> <p>이제 const 를 쓰자.</p> <p>이전에는 비공개 프로퍼티를 만들고, setter 없이 getter 만 만드는 방법으로 만들었다고 한다.</p> <h3 id="체이닝-패턴"><a href="#체이닝-패턴" aria-hidden="true" class="header-anchor">#</a> 체이닝 패턴</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>myobj<span class="token punctuation">.</span><span class="token function">method1</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">method3</span><span class="token punctuation">(</span><span class="token string">&quot;world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">method4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>배우고 싶었던 패턴이다. 아마도 계속 처리 객체를 리턴하는 방식이겠다 생각을 했는데</p> <blockquote><p>만약 메서드에 의미있는 반환 값이 존재하지 않는다면, 현재 작업중인 객체 인스턴스인 this를 반환하게 한다. 이렇게 하면 객체의 사용자는 앞선 메서드에 이어 다음 메서드를 바로 호출 할 수 있다. (p.132)</p></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    value<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token function-variable function">increment</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">add</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">+=</span> v<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">shout</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

obj<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">shout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span>

<span class="token comment">// p.132</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>스스로를 반환하고 있다.</p> <h3 id="method-메서드"><a href="#method-메서드" aria-hidden="true" class="header-anchor">#</a> method() 메서드</h3> <blockquote><p>재사용 가능한 메서드는 생성자의 prototype 프로퍼티에 추가되어야 한다. 그런데 prototype이란 것이 다른 개발자들에게는 낯선 개념일 수 있기 때문에, method()라는 메서드 속에 숨겨두는 것이다. ... 여기서는 method()라는 메서드를 'syntax sugar'로 ... ( p. 133 )</p></blockquote> <p>쓰진 않겠지만, 구현 방법을 봐두면,</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>method <span class="token operator">!==</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">method</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> implementation</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> implementation<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Function의 프로토타입에 method를 붙이고, 모든 function에 붙을 것이고, 체이닝해서</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">Person</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">.</span>
<span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'getName'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'setName'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>호출하고 있기 때문에, this는 생성자 함수 객체를 참조하여, prototype에 함수를 추가케 하고 있다.</p> <h3 id="나름의-실전-문제"><a href="#나름의-실전-문제" aria-hidden="true" class="header-anchor">#</a> 나름의 실전 문제</h3> <p>이로써, 객체 생성패턴을 다 보았는데,<br>
보면서 jquery-color plugin이 생각이 났다. 얼마전에 이를 vue의 어느 컴포넌트에서 갖다쓰고자 했을 때, 그 스크립트를 jQuery를 인자로 받는 함수로 싸고 그 함수를 export 하는 식으로 가져다 썼는데, 이렇게 쓸 수 있었던 것은 jquery-color 스크립트가 jQuery 라는 네임스페이스를 동일하게 사용하여 뭔가 처리를 하고 뭔가를 추가하고 있었기 때문이었다.</p> <p><a href="https://github.com/jquery/jquery-color/blob/master/jquery.color.js" target="_blank" rel="noopener noreferrer">jquery-color<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 에서, 필요 없을 거 같아 지워버렸던 앞 부분에 대해 이제 이해해보고 싶다. 내용은 AMD와 factory 패턴인 것 같다.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/*!
 * jQuery Color Animations v@VERSION
 * https://github.com/jquery/jquery-color
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * Date: @DATE
 */</span>

<span class="token punctuation">(</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">root<span class="token punctuation">,</span> factory</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token keyword">typeof</span> define <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span> <span class="token operator">&amp;&amp;</span> define<span class="token punctuation">.</span>amd <span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token comment">// AMD. Register as an anonymous module.</span>
		<span class="token function">define</span><span class="token punctuation">(</span> <span class="token punctuation">[</span> <span class="token string">&quot;jquery&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> factory <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token keyword">typeof</span> exports <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
		module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span> <span class="token function">require</span><span class="token punctuation">(</span> <span class="token string">&quot;jquery&quot;</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token function">factory</span><span class="token punctuation">(</span> root<span class="token punctuation">.</span>jQuery <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">jQuery<span class="token punctuation">,</span> <span class="token keyword">undefined</span></span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token keyword">var</span> stepHooks <span class="token operator">=</span> <span class="token string">&quot;backgroundColor borderBottomColor borderLeftColor borderRightColor &quot;</span> <span class="token operator">+</span>
		<span class="token string">&quot;borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor&quot;</span><span class="token punctuation">,</span>

	class2type <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	toString <span class="token operator">=</span> class2type<span class="token punctuation">.</span>toString<span class="token punctuation">,</span>

    <span class="token comment">// ...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h2 id="코드-재사용-패턴"><a href="#코드-재사용-패턴" aria-hidden="true" class="header-anchor">#</a> 코드 재사용 패턴</h2> <p>기존 코드를 최대한 재활용하자. 가장 먼저 상속인데.<br>
클래스 방식의 상속과 그렇지 않은 상속 몇 가지를 살펴볼 것이다.<br>
그러나 결국 목적은 코드를 재사용하는 것이다.</p> <ul><li>다른 객체와 합성하는 방법</li> <li>믹스인 객체를 사용하는 방법</li> <li>어떤 것도 영구히 상속하지 않으면서 필요한 기능만 빌려와서 재사용하는 방법</li></ul> <blockquote><p>'클래스 상속보다 객체 합성을 우선시하라.' - GoF</p></blockquote> <h3 id="클래스-방식-vs-새로운-방식의-상속-패턴"><a href="#클래스-방식-vs-새로운-방식의-상속-패턴" aria-hidden="true" class="header-anchor">#</a> 클래스 방식 vs. 새로운 방식의 상속 패턴</h3> <p>'클래스 방식' 상속이란? &quot;자바스크립트에는 클래스가 없고, 인스턴스라는 개념도 잘 맞지 않는다. 자바스크립트의 객체는 단순히 키-값의 쌍들일 뿐이며 언제든지 생성하고 변경할 수 있다.&quot;<br>
&quot;그러나 자바스크립트의 생성자 함수와 new 연산자 문법은 클래스를 사용하는 문법과 매우 닮아 있다.&quot;</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Person</span> adam <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> adam <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>java는 강타입 언어니까 Person 타입을 명시하는 거 빼고는.<br>
new로 호출하더라도 Person 은 여전히 함수이고.<br>
여하튼 '클래스 방식'과 '새로운 방식' 순으로 살펴본다.</p> <blockquote><p>프로젝트에 상속 패턴을 도입하는 데는 몇 가지 선택지가 있을 수 있다. 그러나 클래스가 전혀 관련되지 않는다는 사실을 팀원들이 정말로 불편해하는 게 아니라면, 항상 새로운 방식의 패턴을 선택해야 한다. (p.138)</p></blockquote> <h3 id="클래스-방식의-상속을-사용할-경우-예상되는-산출물"><a href="#클래스-방식의-상속을-사용할-경우-예상되는-산출물" aria-hidden="true" class="header-anchor">#</a> 클래스 방식의 상속을 사용할 경우 예상되는 산출물</h3></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/reading/assets/js/app.13f47444.js" defer></script><script src="/reading/assets/js/10.5ab2a31e.js" defer></script>
  </body>
</html>
